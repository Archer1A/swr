# 创建构建任务<a name="swr_01_0021"></a>

绑定源码仓库账号后，您需要创建构建任务，从源码托管网站下载代码来自动构建镜像。

## 前提条件<a name="section16360348873"></a>

源代码中必须有Dockerfile文件才能构建成功。

## 操作步骤<a name="section164181028183418"></a>

1.  登录容器镜像服务控制台。
2.  在左侧菜单栏选择“镜像构建 \> 构建任务“，单击“创建构建任务“。
3.  填写构建任务参数，参说明请参见[表1](#table386395520144)。

    **表 1**  参数说明

    <a name="table386395520144"></a>
    <table><thead align="left"><tr id="row386455515143"><th class="cellrowborder" valign="top" width="20%" id="mcps1.2.3.1.1"><p id="p3764351618"><a name="p3764351618"></a><a name="p3764351618"></a>参数</p>
    </th>
    <th class="cellrowborder" valign="top" width="80%" id="mcps1.2.3.1.2"><p id="p686465514143"><a name="p686465514143"></a><a name="p686465514143"></a>说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row886425511411"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.3.1.1 "><p id="p108641955121419"><a name="p108641955121419"></a><a name="p108641955121419"></a>*任务名称</p>
    </td>
    <td class="cellrowborder" valign="top" width="80%" headers="mcps1.2.3.1.2 "><p id="p68645554142"><a name="p68645554142"></a><a name="p68645554142"></a>构建任务的名称。</p>
    </td>
    </tr>
    <tr id="row1686485512147"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.3.1.1 "><p id="p12865125551416"><a name="p12865125551416"></a><a name="p12865125551416"></a>描述</p>
    </td>
    <td class="cellrowborder" valign="top" width="80%" headers="mcps1.2.3.1.2 "><p id="p286565561417"><a name="p286565561417"></a><a name="p286565561417"></a>构建任务的描述，支持Markdown格式。</p>
    </td>
    </tr>
    <tr id="row48651255101418"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.3.1.1 "><p id="p1686525561415"><a name="p1686525561415"></a><a name="p1686525561415"></a>*代码源</p>
    </td>
    <td class="cellrowborder" valign="top" width="80%" headers="mcps1.2.3.1.2 "><p id="p093931222611"><a name="p093931222611"></a><a name="p093931222611"></a>代码源，选择代码仓库。</p>
    <p id="p1975413214286"><a name="p1975413214286"></a><a name="p1975413214286"></a>如果未绑定源码托管网站的账号，请单击<span class="uicontrol" id="uicontrol76651014297"><a name="uicontrol76651014297"></a><a name="uicontrol76651014297"></a>“绑定账号”</span>，具体步骤请参见<a href="绑定源码仓库账号.md">绑定源码仓库账号</a>。</p>
    </td>
    </tr>
    <tr id="row6802244392"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.3.1.1 "><p id="p1781202415393"><a name="p1781202415393"></a><a name="p1781202415393"></a>*构建设置</p>
    </td>
    <td class="cellrowborder" valign="top" width="80%" headers="mcps1.2.3.1.2 "><a name="ul977711411468"></a><a name="ul977711411468"></a><ul id="ul977711411468"><li><span class="keyword" id="keyword186591746133712"><a name="keyword186591746133712"></a><a name="keyword186591746133712"></a>代码分支</span>：选择使用哪个代码分支。</li><li><span class="keyword" id="keyword5428144193713"><a name="keyword5428144193713"></a><a name="keyword5428144193713"></a>Dockerfile目录</span>：此处填写Dockerfile文件在源代码中的路径。<a name="ul58441038410"></a><a name="ul58441038410"></a><ul id="ul58441038410"><li>如果Dockerfile文件在根目录下，文件名称为Dockerfile，此处填写<span class="filepath" id="filepath8462130104610"><a name="filepath8462130104610"></a><a name="filepath8462130104610"></a>“/Dockerfile”</span>。</li></ul>
    </li><li><span class="keyword" id="keyword15422849113713"><a name="keyword15422849113713"></a><a name="keyword15422849113713"></a>自定义构建路径</span>：构建工程目录，由用户自定义。该目录或其子目录必须包含Dockerfile文件。<a name="ul16439711249"></a><a name="ul16439711249"></a><ul id="ul16439711249"><li>如果Dockerfile文件在根目录下，此处可不填。</li><li>如果Dockerfile文件在“/src/a”目录下，文件名称为Dockerfile，则Dockerfile目录填写<span class="filepath" id="filepath1842617911411"><a name="filepath1842617911411"></a><a name="filepath1842617911411"></a>“/src/a/Dockerfile”</span>，自定义构建路径可为<span class="filepath" id="filepath1942614920414"><a name="filepath1942614920414"></a><a name="filepath1942614920414"></a>“/”</span>或<span class="filepath" id="filepath04264918418"><a name="filepath04264918418"></a><a name="filepath04264918418"></a>“/src”</span>或<span class="filepath" id="filepath13426694411"><a name="filepath13426694411"></a><a name="filepath13426694411"></a>“/src/a”</span>。</li></ul>
    </li></ul>
    </td>
    </tr>
    <tr id="row856019166336"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.3.1.1 "><p id="p1856271616331"><a name="p1856271616331"></a><a name="p1856271616331"></a><span class="keyword" id="keyword1074404183812"><a name="keyword1074404183812"></a><a name="keyword1074404183812"></a>构建缓存</span></p>
    </td>
    <td class="cellrowborder" valign="top" width="80%" headers="mcps1.2.3.1.2 "><p id="p0562216143313"><a name="p0562216143313"></a><a name="p0562216143313"></a>若勾选<span class="uicontrol" id="uicontrol1461618313412"><a name="uicontrol1461618313412"></a><a name="uicontrol1461618313412"></a>“缓存构建信息”</span>，可以对构建信息进行缓存，提升下次构建速度。</p>
    </td>
    </tr>
    <tr id="row116007477171"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.3.1.1 "><p id="p10601124731713"><a name="p10601124731713"></a><a name="p10601124731713"></a>*组织</p>
    </td>
    <td class="cellrowborder" valign="top" width="80%" headers="mcps1.2.3.1.2 "><p id="p160164741717"><a name="p160164741717"></a><a name="p160164741717"></a>构建输出的镜像所在的组织。</p>
    </td>
    </tr>
    <tr id="row15538486171"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.3.1.1 "><p id="p85374816172"><a name="p85374816172"></a><a name="p85374816172"></a>*镜像名称</p>
    </td>
    <td class="cellrowborder" valign="top" width="80%" headers="mcps1.2.3.1.2 "><p id="p55314817175"><a name="p55314817175"></a><a name="p55314817175"></a>镜像名称。</p>
    <p id="p13282927191712"><a name="p13282927191712"></a><a name="p13282927191712"></a>小写字母或数字开头，后面跟小写字母、数字、下划线或中划线（其中下划线最多允许连续两个，并且不能直接与中划线相连），小写字母或数字结尾，1-128个字符。</p>
    </td>
    </tr>
    <tr id="row1522584831715"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.3.1.1 "><p id="p1022719485170"><a name="p1022719485170"></a><a name="p1022719485170"></a>*镜像版本前缀</p>
    </td>
    <td class="cellrowborder" valign="top" width="80%" headers="mcps1.2.3.1.2 "><p id="p7227648121711"><a name="p7227648121711"></a><a name="p7227648121711"></a>镜像版本前缀，例如前缀设置为”version“，则构建成功的镜像版本号为”version.n“，n为构建成功的次数，从”1“开始，每构建成功一次自动加一。</p>
    <p id="p10330111085817"><a name="p10330111085817"></a><a name="p10330111085817"></a>大小写字母、数字或下划线开头，后面跟大小写字母、数字以及点、中划线、下划线，1-16个字符。</p>
    </td>
    </tr>
    </tbody>
    </table>

4.  单击“创建“。

    创建成功后会在构建任务页面显示，如下图所示。

    **图 1**  创建<a name="fig6813518133713"></a>  
    ![](figures/创建.png "创建")

5.  构建镜像单击创建的构建任务，进入详情，单击右上角![](figures/构建镜像.png)，选择“自定义Commit ID“，单击“构建“。

    **图 2**  创建构建任务<a name="fig121596476376"></a>  
    ![](figures/创建构建任务.png "创建构建任务")

    构建任务开始后，在详情页下方“构建历史“tab页显示详细的构建信息。

    镜像构建成功后，在“我的镜像“中可以查看到构建的镜像。


